function e(e){const t=document.createElement("div");t.classList.add("mt-chart");const n="1rem",r=document.createElement("style");r.textContent=`\n.mt-chart, .mt-chart * {\n  box-sizing: border-box;\n}\n\n.mt-chart {\n  display: flex;\n  position: relative;\n  background-color: darkgray;\n  min-height: 100%;\n  cursor: crosshair;\n  padding-inline: ${n};\n\n  --mt-dark-highlight: #ffd800;\n  --mt-light-highlight: yellow;\n}\n\n.mt-bar {\n  flex: 1 1 100%;\n  background-color: var(--mt-bar-color);\n}\n\n.mt-bar-wrapper {\n  min-height: 100%;\n  position: relative;\n  display: flex;\n  align-items: flex-end;\n  flex: 1 0 1px;\n}\n\n.mt-bar-wrapper:hover {\n  background-color: var(--mt-light-highlight);\n}\n\n.mt-bar-wrapper:hover .mt-bar {\n  background-color: var(--mt-dark-highlight);\n}\n\n.mt-bar-wrapper::before {\n  display: none;\n  position: absolute;\n  content: attr(data-time) ' on move ' attr(data-move);\n  top: 0px;\n  min-width: 10rem;\n  padding: 0.2rem;\n  background-color: white;\n  border-radius: 5px;\n  z-index: 1;\n  text-align: center;\n  pointer-events: none;\n}\n\n.mt-bar-wrapper:hover::before {\n  display: inline;\n}\n\n.mt-bar-wrapper--left::before {\n  left: 100%;\n  border-top-left-radius: 0;\n  border-bottom-left-radius: 0;\n}\n\n.mt-bar-wrapper--right::before {\n  right: 100%;\n  border-top-right-radius: 0;\n  border-bottom-right-radius: 0;\n}\n\n/* Only when there's no hovered bar, show current bar and its tooltip */\n.mt-chart:not(:has(.mt-bar-wrapper:hover)) {\n  & .mt-bar-wrapper--current {\n    background-color: var(--mt-light-highlight);\n  }\n\n  & .mt-bar-wrapper--current .mt-bar {\n    background-color: var(--mt-dark-highlight);\n  }\n\n  & .mt-bar-wrapper--current::before {\n    display: inline;\n  }\n}\n\n.mt-yaxis-tick {\n  border-top: 1px dashed lightgray;\n  left: ${n};\n  right: ${n};\n  height: 0;\n  position: absolute;\n  z-index: 0;\n}`,t.appendChild(r);const o=Math.max(...e.map((e=>e.millis))),a=1.1*o;for(const e of function(e,t){const n=[];let r=t;for(;r<e;)n.push(r),r+=t;return n}(o,3e4)){const n=document.createElement("div");n.classList.add("mt-yaxis-tick"),n.style.bottom=String(e/a*100)+"%",t.appendChild(n)}return e.forEach((n=>{const r=document.createElement("div");r.classList.add("mt-bar"),r.style.height=n.millis/a*100+"%",r.style.setProperty("--mt-bar-color","black"===n.color?"black":"white");const o=document.createElement("div");o.classList.add("mt-bar-wrapper","mt-bar-wrapper--"+(n.move/e.length<.5?"left":"right")),o.dataset.time=function(e){const t=e/1e3,n=e>=1e3?Math.round(t):t;return n<60?function(e){const t=e.toFixed(1);return(t.endsWith(".0")?t.slice(0,-2):t)+"s"}(n):function(e){const t=Math.trunc(e%60);return[Math.trunc(e/60)+"m",0!==t?t+"s":""].filter((e=>e)).join(" ")}(n)}(n.millis),o.dataset.move=n.move,o.appendChild(r),t.appendChild(o)})),{chart:t,markCurrentBar(e){const n="mt-bar-wrapper--current",r=t.querySelector("."+n);r&&r.classList.remove(n);const o=t.querySelector(`.mt-bar-wrapper[data-move="${e}"]`);o&&o.classList.add(n)}}}const t="mt-widget";function n(e,t,n){e.remove();const r="before"===t?"beforebegin":"afterend";n.insertAdjacentElement(r,e)}if(!(document.getElementsByClassName(t).length>0))try{const r=function(e){const t=/https:\/\/online-go\.com\/game\/view\/(\d+)/.exec(e),n=t?t[1]:null;if(!n)throw new Error("The move timing chart can only be loaded from OGS games.\n\nIf you're in a review, load the chart in game view first then return to the review.");return n}(window.location.toString()),{playerCards:o,actionBar:a,moveNumberContainer:i}=function(){const e=document.querySelector("div:has(> .players)"),t=document.querySelector(".action-bar"),n=document.querySelector(".move-number");if(!e)throw new Error("Unable to find players: div:has(> .players)");if(!t)throw new Error("Unable to find action bar: .action-bar");if(!n)throw new Error("Unable to find move number: .move-number");return{playerCards:e,actionBar:t,moveNumberContainer:n}}(),l=[],c=()=>l.forEach((e=>e())),s=!1,{toolbar:d,setToolbarActions:m}=function(e){let t=e;const n=document.createElement("div");n.style.display="flex",n.style.gap="0.4rem",n.style.flex="0 0 auto";const r=(e,t)=>{const n=document.createElement("button");return n.id=e,n.textContent=t,n},o=r("mt-hide","Hide");n.appendChild(o);const a=r("mt-toggle",t?"Collapse":"Expand");return n.appendChild(a),{toolbar:n,setToolbarActions(e){o.addEventListener("click",e.onHide),a.addEventListener("click",(()=>{t?(e.onCollapse(),a.textContent="Expand"):(e.onExpand(),a.textContent="Collapse"),t=!t}))}}}(s),{content:h,widget:p,tearDownWidget:u}=function(e){const n=document.createElement("div");n.classList.add(t),n.style.display="flex",n.style.flexDirection="column",n.style.paddingBlock="1rem",n.style.gap="0.5rem",n.style.boxSizing="border-box",n.style.flex="1 0 12rem";const r=document.createElement("div");return r.style.flex="1 1 100%",n.appendChild(e),n.appendChild(r),{widget:n,content:r,tearDownWidget(){n.remove()}}}(d);l.push(u);const b=()=>n(p,"after",o);m({onHide:c,onExpand:()=>n(p,"before",a),onCollapse:b}),s||b(),h.replaceChildren("Loading..."),function(e){return fetch(function(e){return`https://online-go.com/api/v1/games/${e}`}(e)).then((e=>e.json()))}(r).then((t=>{const n=function(e){const t="black"===e.gamedata.initial_player,n=t?"black":"white",r=t?"white":"black";return e.gamedata.moves.map(((e,t)=>{const o=t+1;var a;return{move:o,color:(a=o,a%2==1?n:r),millis:e[2]}}))}(t),{chart:r,markCurrentBar:o}=e(n);h.replaceChildren(r);const a=function(e,t){const n=e=>{const n=e.split("").filter((e=>e.match(/\d/))).join("");n&&t(Number(n))};n(e.textContent);const r=new MutationObserver((e=>{e.filter((e=>"characterData"===e.type)).forEach((e=>n(e.target.data)))}));return r.observe(e,{characterData:!0,subtree:!0}),()=>r.disconnect()}(i,(e=>o(e)));l.push(a)})).catch((e=>console.error(e)))}catch(e){console.error(e),alert("Error: "+e.message)}
