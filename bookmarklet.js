if(console.log("running..."),!(document.getElementsByClassName("mt-widget").length>0)){console.log("not already on page, doing more");try{const e=function(e){const t=/https:\/\/online-go\.com\/(game|review)\/(\d+)/.exec(e),n=t?t[2]:null;if(!n)throw new Error("This only works on OGS games and OGS game reviews");return n}(window.location.toString()),{actionBar:t,moveNumberContainer:n}=function(){const e=document.querySelector(".action-bar"),t=document.querySelector(".move-number");if(!e)throw new Error("Unable to find action bar (.action-bar)");if(!t)throw new Error("Unable to find move number (.move-number)");return{actionBar:e,moveNumberContainer:t}}(),r=[],o=()=>r.forEach((e=>e())),{content:a,widget:i,attachToDom:c}=function(e){const t=document.createElement("div");t.classList.add("mt-widget"),t.style.display="flex",t.style.flexDirection="column",t.style.padding="1rem",t.style.gap="0.5rem",t.style.boxSizing="border-box",t.style.flex="1 0 16rem";const n=document.createElement("div");return n.style.flex="1 1 100%",t.appendChild(e),t.appendChild(n),{widget:t,content:n,attachToDom(e){e.parentElement.insertBefore(t,e)}}}(function(e){const t=document.createElement("div");return t.style.flex="0 0 auto",t.innerHTML='<button id="mt-hide">Hide</button>',t.addEventListener("click",(t=>{t.target instanceof HTMLButtonElement&&"mt-hide"===t.target.id&&e()})),t}(o));c(t),r.push((()=>i.remove())),a.replaceChildren("Loading..."),function(e){return fetch(function(e){return`https://online-go.com/api/v1/games/${e}`}(e)).then((e=>e.json()))}(e).then((e=>{const t=function(e){const t="black"===e.gamedata.initial_player;return e.gamedata.moves.map(((e,n)=>{const r=n+1;var o;return{move:r,color:(o=r,o%2==1&&t?"black":"white"),millis:e[2]}}))}(e);(function(e,t){const n=document.createElement("div");n.classList.add("mt-chart");const r="1rem",o=document.createElement("style");o.textContent=`\n.mt-chart, .mt-chart * {\n  box-sizing: border-box;\n}\n\n.mt-chart {\n  display: flex;\n  position: relative;\n  background-color: darkgray;\n  min-height: 100%;\n  cursor: crosshair;\n  padding-inline: ${r};\n\n  --mt-dark-highlight: #ffd800;\n  --mt-light-highlight: yellow;\n}\n\n.mt-bar {\n  flex: 1 1 100%;\n  background-color: var(--mt-bar-color);\n}\n\n.mt-bar-wrapper {\n  min-height: 100%;\n  position: relative;\n  display: flex;\n  align-items: flex-end;\n  flex: 1 0 3px;\n}\n\n.mt-bar-wrapper:hover {\n  background-color: var(--mt-light-highlight);\n}\n\n.mt-bar-wrapper:hover .mt-bar {\n  background-color: var(--mt-dark-highlight);\n}\n\n.mt-bar-wrapper::before {\n  display: none;\n  position: absolute;\n  content: attr(data-seconds) 's on move ' attr(data-move);\n  top: 0px;\n  min-width: 10rem;\n  padding: 0.2rem;\n  background-color: white;\n  border-radius: 5px;\n  z-index: 1;\n  text-align: center;\n  pointer-events: none;\n}\n\n.mt-bar-wrapper:hover::before {\n  display: inline;\n}\n\n.mt-bar-wrapper--left::before {\n  left: 0;\n}\n\n.mt-bar-wrapper--right::before {\n  right: 0;\n}\n\n/* Only when there's no hovered bar, show current bar and its tooltip */\n.mt-chart:not(:has(.mt-bar-wrapper:hover)) {\n  & .mt-bar-wrapper--current {\n    background-color: var(--mt-light-highlight);\n  }\n\n  & .mt-bar-wrapper--current .mt-bar {\n    background-color: var(--mt-dark-highlight);\n  }\n\n  & .mt-bar-wrapper--current::before {\n    display: inline;\n  }\n}\n\n.mt-yaxis-tick {\n  border-top: 1px dashed lightgray;\n  left: ${r};\n  right: ${r};\n  height: 0;\n  position: absolute;\n  z-index: 0;\n}`,n.appendChild(o);const a=Math.max(...t.map((e=>e.millis))),i=1.1*a;for(const e of function(e,t){const n=[];let r=t;for(;r<e;)n.push(r),r+=t;return n}(a,3e4)){const t=document.createElement("div");t.classList.add("mt-yaxis-tick"),t.style.bottom=String(e/i*100)+"%",n.appendChild(t)}t.forEach((e=>{const r=document.createElement("div");r.classList.add("mt-bar"),r.style.height=e.millis/i*100+"%",r.style.setProperty("--mt-bar-color","black"===e.color?"black":"white");const o=document.createElement("div");o.classList.add("mt-bar-wrapper","mt-bar-wrapper--"+(e.move/t.length<.5?"left":"right")),o.dataset.seconds=Number(e.millis/1e3).toFixed(1),o.dataset.move=e.move,o.appendChild(r),n.appendChild(o)})),e.replaceChildren(n)})(a,t);const o=function(e,t){const n=e=>{const n=e.split("").filter((e=>e.match(/\d/))).join("");n&&t(Number(n))};n(e.textContent);const r=new MutationObserver((e=>{e.filter((e=>"characterData"===e.type)).forEach((e=>n(e.target.data)))}));return r.observe(e,{characterData:!0,subtree:!0}),()=>r.disconnect()}(n,(e=>function(e){const t="mt-bar-wrapper--current",n=document.querySelector("."+t);n&&n.classList.remove(t);const r=document.querySelector(`.mt-bar-wrapper[data-move="${e}"]`);r&&r.classList.add(t)}(e)));r.push(o)})).catch((e=>console.error(e)))}catch(e){console.error(e),alert("Error: "+e.message)}}
