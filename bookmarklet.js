if(!(document.getElementsByClassName("mt-widget").length>0))try{const t=function(t){const e=/https:\/\/online-go\.com\/(game|review)\/(\d+)/.exec(t),n=e?e[2]:null;if(!n)throw new Error("This only works on OGS games and OGS game reviews");return n}(window.location.toString()),e=[],n=()=>e.forEach((t=>t())),{content:r,widget:o}=function(t){const e=document.createElement("div");e.classList.add("mt-widget"),e.style.display="flex",e.style.flexDirection="column",e.style.padding="1rem",e.style.gap="0.5rem",e.style.boxSizing="border-box",e.style.flex="1 0 16rem";const n=document.createElement("div");return n.style.flex="1 1 100%",e.appendChild(t),e.appendChild(n),{widget:e,content:n}}(function(t){const e=document.createElement("div");return e.style.flex="0 0 auto",e.innerHTML='<button id="mt-hide">Hide</button>',e.addEventListener("click",(e=>{e.target instanceof HTMLButtonElement&&"mt-hide"===e.target.id&&t()})),e}(n));(function(t){const e=document.querySelector(".action-bar");if(!e)throw new Error("Could not find insertion point (.action-bar)");e.parentElement.insertBefore(t,e)})(o),e.push((()=>o.remove())),r.replaceChildren("Loading..."),function(t){return fetch(function(t){return`https://online-go.com/api/v1/games/${t}`}(t)).then((t=>t.json()))}(t).then((t=>{const n=function(t){const e="black"===t.gamedata.initial_player;return t.gamedata.moves.map(((t,n)=>{const r=n+1;var o;return{move:r,color:(o=r,o%2==1&&e?"black":"white"),millis:t[2]}}))}(t);(function(t,e){const n=document.createElement("div");n.classList.add("mt-chart");const r="1rem",o=document.createElement("style");o.textContent=`\n.mt-chart, .mt-chart * {\n  box-sizing: border-box;\n}\n\n.mt-chart {\n  display: flex;\n  position: relative;\n  background-color: darkgray;\n  min-height: 100%;\n  cursor: crosshair;\n  padding-inline: ${r};\n\n  --mt-dark-highlight: #ffd800;\n  --mt-light-highlight: yellow;\n}\n\n.mt-bar {\n  flex: 1 1 100%;\n  background-color: var(--mt-bar-color);\n}\n\n.mt-bar-wrapper {\n  min-height: 100%;\n  position: relative;\n  display: flex;\n  align-items: flex-end;\n  flex: 1 0 3px;\n}\n\n.mt-bar-wrapper:hover {\n  background-color: var(--mt-light-highlight);\n}\n\n.mt-bar-wrapper:hover .mt-bar {\n  background-color: var(--mt-dark-highlight);\n}\n\n.mt-bar-wrapper::before {\n  display: none;\n  position: absolute;\n  content: attr(data-seconds) 's on move ' attr(data-move);\n  top: 0px;\n  min-width: 10rem;\n  padding: 0.2rem;\n  background-color: white;\n  border-radius: 5px;\n  z-index: 1;\n  text-align: center;\n  pointer-events: none;\n}\n\n.mt-bar-wrapper:hover::before {\n  display: inline;\n}\n\n.mt-bar-wrapper--left::before {\n  left: 0;\n}\n\n.mt-bar-wrapper--right::before {\n  right: 0;\n}\n\n/* Only when there's no hovered bar, show current bar and its tooltip */\n.mt-chart:not(:has(.mt-bar-wrapper:hover)) {\n  & .mt-bar-wrapper--current {\n    background-color: var(--mt-light-highlight);\n  }\n\n  & .mt-bar-wrapper--current .mt-bar {\n    background-color: var(--mt-dark-highlight);\n  }\n\n  & .mt-bar-wrapper--current::before {\n    display: inline;\n  }\n}\n\n.mt-yaxis-tick {\n  border-top: 1px dashed lightgray;\n  left: ${r};\n  right: ${r};\n  height: 0;\n  position: absolute;\n  z-index: 0;\n}`,n.appendChild(o);const a=Math.max(...e.map((t=>t.millis))),i=1.1*a;for(const t of function(t,e){const n=[];let r=e;for(;r<t;)n.push(r),r+=e;return n}(a,3e4)){const e=document.createElement("div");e.classList.add("mt-yaxis-tick"),e.style.bottom=String(t/i*100)+"%",n.appendChild(e)}e.forEach((t=>{const r=document.createElement("div");r.classList.add("mt-bar"),r.style.height=t.millis/i*100+"%",r.style.setProperty("--mt-bar-color","black"===t.color?"black":"white");const o=document.createElement("div");o.classList.add("mt-bar-wrapper","mt-bar-wrapper--"+(t.move/e.length<.5?"left":"right")),o.dataset.seconds=Number(t.millis/1e3).toFixed(1),o.dataset.move=t.move,o.appendChild(r),n.appendChild(o)})),t.replaceChildren(n)})(r,n);const o=function(t){const e=e=>{const n=e.split("").filter((t=>t.match(/\d/))).join("");n&&t(Number(n))},n=new MutationObserver((t=>{t.filter((t=>"characterData"===t.type)).forEach((t=>e(t.target.data)))})),r=document.querySelector(".move-number");return r&&(e(r.textContent),n.observe(r,{characterData:!0,subtree:!0})),()=>n.disconnect()}((t=>function(t){const e="mt-bar-wrapper--current",n=document.querySelector("."+e);n&&n.classList.remove(e);const r=document.querySelector(`.mt-bar-wrapper[data-move="${t}"]`);r&&r.classList.add(e)}(t)));e.push(o)})).catch((t=>console.error(t)))}catch(t){console.error(t),alert("Error: "+t.message)}
